<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="RS-eco" />

<meta name="date" content="2019-12-20" />

<title>Derive global landonly ISIMIP data</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Derive global landonly ISIMIP data</h1>
<h4 class="author">RS-eco</h4>
<h4 class="date">2019-12-20</h4>



<div id="data-setup" class="section level2">
<h2>Data Setup</h2>
<p>Install rISIMIP package</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># Install remotes if not previously installed</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="cf">if</span>(<span class="op">!</span><span class="st">&quot;remotes&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">installed.packages</span>()[,<span class="st">&quot;Package&quot;</span>]) <span class="kw">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co"># Install rISIMIP from Github if not previously installed</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="cf">if</span>(<span class="op">!</span><span class="st">&quot;rISIMIP&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">installed.packages</span>()[,<span class="st">&quot;Package&quot;</span>]) remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;RS-eco/rISIMIP&quot;</span>)</a></code></pre></div>
<p>Load rISIMIP package</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(rISIMIP)</a></code></pre></div>
<p>First, we specify the file path, where the ISIMIP2b data is located.</p>
<p><strong>Note:</strong> The following script requires that you already have the ISIMIP2b bias-corrected GCM_atmosphere data on your local harddrive.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Specify path of file directory</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#filedir &lt;- &quot;/media/matt/Data/Documents/Wissenschaft/Data/&quot;</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">filedir &lt;-<span class="st"> &quot;/work/bb0820/ISIMIP/&quot;</span></a></code></pre></div>
</div>
<div id="summarise-climate-data" class="section level2">
<h2>Summarise climate data</h2>
<p>First, we need the <code>summariseNC</code> function from the <code>processNC</code> package. Thus, we have to install the processNC package from Github.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Install processNC from Github if not previously installed</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="cf">if</span>(<span class="op">!</span><span class="st">&quot;processNC&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">installed.packages</span>()[,<span class="st">&quot;Package&quot;</span>]) remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;RS-eco/processNC&quot;</span>)</a></code></pre></div>
<p>Load processNC package</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">library</span>(processNC)</a></code></pre></div>
<p>We now list and summarise the climate data for the required time steps (2006-2035, 2036-2065, 2066-2095, 2086-2115, 2136-2165) for each variable and each model using global ISIMIP2b data.</p>
</div>
<div id="certain-years-1.5-degree-time-slices" class="section level2">
<h2>Certain years + 1.5 degree time slices</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co">#Timeframes</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">timeframe &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1845&quot;</span>,<span class="st">&quot;1990&quot;</span>,<span class="st">&quot;1995&quot;</span>,<span class="st">&quot;2009&quot;</span>,<span class="st">&quot;2010&quot;</span>,<span class="st">&quot;2020&quot;</span>,<span class="st">&quot;2026&quot;</span>,<span class="st">&quot;2032&quot;</span>,<span class="st">&quot;2048&quot;</span>,</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">               <span class="st">&quot;2050&quot;</span>,<span class="st">&quot;2052&quot;</span>, <span class="st">&quot;2056&quot;</span>,<span class="st">&quot;2080&quot;</span>,<span class="st">&quot;2100&quot;</span>,<span class="st">&quot;2150&quot;</span>,<span class="st">&quot;2200&quot;</span>,<span class="st">&quot;2250&quot;</span>)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">startyear &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1830</span>,<span class="dv">1976</span>,<span class="dv">1980</span>,<span class="dv">1995</span>,<span class="dv">1996</span>,<span class="dv">2006</span>,<span class="dv">2012</span>,<span class="dv">2018</span>,<span class="dv">2034</span>,</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">               <span class="dv">2036</span>,<span class="dv">2038</span>,<span class="dv">2042</span>,<span class="dv">2066</span>,<span class="dv">2086</span>,<span class="dv">2136</span>,<span class="dv">2186</span>,<span class="dv">2236</span>)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">endyear &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1859</span>,<span class="dv">2005</span>,<span class="dv">2009</span>,<span class="dv">2024</span>,<span class="dv">2025</span>,<span class="dv">2035</span>,<span class="dv">2041</span>,<span class="dv">2047</span>,<span class="dv">2063</span>,</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">             <span class="dv">2065</span>,<span class="dv">2067</span>,<span class="dv">2071</span>,<span class="dv">2095</span>,<span class="dv">2115</span>,<span class="dv">2165</span>,<span class="dv">2215</span>,<span class="dv">2265</span>)</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">timeperiods &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">timeframe=</span>timeframe, <span class="dt">startyear=</span>startyear,<span class="dt">endyear=</span>endyear)</a>
<a class="sourceLine" id="cb6-9" data-line-number="9"></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#Climate variables</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;tasmin&quot;</span>, <span class="st">&quot;tasmax&quot;</span>, <span class="st">&quot;pr&quot;</span>)</a>
<a class="sourceLine" id="cb6-12" data-line-number="12"></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#Climate models</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14">models &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;GFDL-ESM2M&quot;</span>, <span class="st">&quot;HadGEM2-ES&quot;</span>, <span class="st">&quot;IPSL-CM5A-LR&quot;</span>, <span class="st">&quot;MIROC5&quot;</span>)</a>
<a class="sourceLine" id="cb6-15" data-line-number="15"></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#RCP scenarios</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17">rcps &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;rcp26&quot;</span>, <span class="st">&quot;rcp60&quot;</span>)</a>
<a class="sourceLine" id="cb6-18" data-line-number="18"></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="co">#Create list of variable, climate model and time frame combination</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20">var_mod_time &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">var =</span> vars, <span class="dt">model =</span> models, </a>
<a class="sourceLine" id="cb6-21" data-line-number="21">                            <span class="dt">timeframe =</span> timeframe, <span class="dt">rcp =</span> rcps)</a>
<a class="sourceLine" id="cb6-22" data-line-number="22"></a>
<a class="sourceLine" id="cb6-23" data-line-number="23"><span class="co"># Add historical scenario</span></a>
<a class="sourceLine" id="cb6-24" data-line-number="24">df &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">rcp=</span><span class="st">&quot;historical&quot;</span>, <span class="dt">var=</span>vars, <span class="dt">model=</span>models, <span class="dt">timeframe =</span> <span class="st">&quot;1990&quot;</span>)</a>
<a class="sourceLine" id="cb6-25" data-line-number="25">var_mod_time &lt;-<span class="st"> </span><span class="kw">rbind</span>(df, var_mod_time)</a>
<a class="sourceLine" id="cb6-26" data-line-number="26"></a>
<a class="sourceLine" id="cb6-27" data-line-number="27"><span class="co"># Add EWEMBI scenario</span></a>
<a class="sourceLine" id="cb6-28" data-line-number="28">df &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">rcp=</span><span class="st">&quot;1995&quot;</span>, <span class="dt">var=</span>vars, <span class="dt">model=</span><span class="st">&quot;EWEMBI&quot;</span>, <span class="dt">timeframe =</span> <span class="st">&quot;1995&quot;</span>)</a>
<a class="sourceLine" id="cb6-29" data-line-number="29">var_mod_time &lt;-<span class="st"> </span><span class="kw">rbind</span>(df, var_mod_time)</a>
<a class="sourceLine" id="cb6-30" data-line-number="30"></a>
<a class="sourceLine" id="cb6-31" data-line-number="31"><span class="co"># Add piControl scenario</span></a>
<a class="sourceLine" id="cb6-32" data-line-number="32">df &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">rcp=</span><span class="st">&quot;piControl&quot;</span>, <span class="dt">var=</span>vars, <span class="dt">model=</span>models, <span class="dt">timeframe =</span> <span class="st">&quot;1845&quot;</span>)</a>
<a class="sourceLine" id="cb6-33" data-line-number="33">var_mod_time &lt;-<span class="st"> </span><span class="kw">rbind</span>(df, var_mod_time)</a>
<a class="sourceLine" id="cb6-34" data-line-number="34"><span class="kw">rm</span>(vars, models, timeframe, rcps)</a>
<a class="sourceLine" id="cb6-35" data-line-number="35"></a>
<a class="sourceLine" id="cb6-36" data-line-number="36">var_mod_time &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">left_join</span>(var_mod_time, timeperiods, <span class="dt">by=</span><span class="st">&quot;timeframe&quot;</span>); <span class="kw">rm</span>(timeperiods)</a></code></pre></div>
</div>
<div id="slow-method" class="section level2">
<h2>Slow method</h2>
<p><strong>Note:</strong> Be aware that the following code chunk will take a very long time to run, even on a high-performance computer. A faster method is shown in the 2nd R code chunk below, however this approach requires the Climate Data Operators programme installed on your computer.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># Run summariseNC for all combinations</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(var_mod_time), <span class="dt">FUN=</span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  files &lt;-<span class="st"> </span><span class="kw">listISIMIP</span>(<span class="dt">path=</span>filedir, <span class="dt">var=</span>var_mod_time<span class="op">$</span>var[x], <span class="dt">extent=</span><span class="st">&quot;global&quot;</span>, </a>
<a class="sourceLine" id="cb7-4" data-line-number="4">                      <span class="dt">model=</span>var_mod_time<span class="op">$</span>model[x], </a>
<a class="sourceLine" id="cb7-5" data-line-number="5">                      <span class="dt">scenario=</span>var_mod_time<span class="op">$</span>rcp[x], </a>
<a class="sourceLine" id="cb7-6" data-line-number="6">                      <span class="dt">startyear=</span>var_mod_time<span class="op">$</span>startyear[x], </a>
<a class="sourceLine" id="cb7-7" data-line-number="7">                      <span class="dt">endyear=</span>var_mod_time<span class="op">$</span>endyear[x])</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">  filename1 &lt;-<span class="st"> </span><span class="kw">paste0</span>(filedir, <span class="st">&quot;/ISIMIP2b/DerivedInputData/GCM/global/&quot;</span>, </a>
<a class="sourceLine" id="cb7-9" data-line-number="9">                      var_mod_time<span class="op">$</span>rcp[x], <span class="st">&quot;/monthly_&quot;</span>, </a>
<a class="sourceLine" id="cb7-10" data-line-number="10">                      var_mod_time<span class="op">$</span>var[x], <span class="st">&quot;_&quot;</span>, var_mod_time<span class="op">$</span>model[x], <span class="st">&quot;_&quot;</span>,</a>
<a class="sourceLine" id="cb7-11" data-line-number="11">                      var_mod_time<span class="op">$</span>rcp[x], <span class="st">&quot;_&quot;</span>, var_mod_time<span class="op">$</span>timeframe[x], </a>
<a class="sourceLine" id="cb7-12" data-line-number="12">                      <span class="st">&quot;.nc4&quot;</span>)</a>
<a class="sourceLine" id="cb7-13" data-line-number="13">  <span class="cf">if</span>(<span class="kw">length</span>(files)<span class="op">==</span><span class="dv">4</span>){</a>
<a class="sourceLine" id="cb7-14" data-line-number="14">    <span class="cf">if</span>(<span class="op">!</span><span class="kw">file.exists</span>(filename1)){</a>
<a class="sourceLine" id="cb7-15" data-line-number="15">      data_sub &lt;-<span class="st"> </span><span class="kw">summariseNC</span>(<span class="dt">files=</span>files, </a>
<a class="sourceLine" id="cb7-16" data-line-number="16">                              <span class="dt">startdate=</span>var_mod_time<span class="op">$</span>startyear[x], </a>
<a class="sourceLine" id="cb7-17" data-line-number="17">                              <span class="dt">enddate=</span>var_mod_time<span class="op">$</span>endyear[x], </a>
<a class="sourceLine" id="cb7-18" data-line-number="18">                              <span class="dt">filename1=</span>filename1, <span class="dt">format=</span><span class="st">&quot;CDF&quot;</span>, </a>
<a class="sourceLine" id="cb7-19" data-line-number="19">                              <span class="dt">overwrite=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-20" data-line-number="20">    }</a>
<a class="sourceLine" id="cb7-21" data-line-number="21">  }</a>
<a class="sourceLine" id="cb7-22" data-line-number="22">  <span class="kw">print</span>(x<span class="op">/</span><span class="kw">nrow</span>(var_mod_time)<span class="op">*</span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb7-23" data-line-number="23">})</a>
<a class="sourceLine" id="cb7-24" data-line-number="24"><span class="co">#system(&quot;shutdown -s -f&quot;)</span></a></code></pre></div>
</div>
<div id="fast-method-using-cdo" class="section level2">
<h2>Fast method using CDO</h2>
<p><strong>Advice:</strong> Run this directly on ISIMIP Server, saves you the download of the data.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co">#Turn var_mod_time into correct order</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">var_mod_time &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">arrange</span>(var_mod_time, rcp, model, var)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#Create outfile list</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">var_mod_time<span class="op">$</span>outfile &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(var_mod_time), <span class="dt">FUN=</span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">  <span class="kw">paste0</span>(filedir, <span class="st">&quot;/ISIMIP2b/&quot;</span>, var_mod_time<span class="op">$</span>var[x], <span class="st">&quot;_day_&quot;</span>, var_mod_time<span class="op">$</span>model[x], <span class="st">&quot;_&quot;</span>, </a>
<a class="sourceLine" id="cb8-7" data-line-number="7">         var_mod_time<span class="op">$</span>rcp[x], <span class="st">&quot;_&quot;</span>, <span class="kw">floor</span>(var_mod_time<span class="op">$</span>startyear[x]<span class="op">/</span><span class="dv">10</span>)<span class="op">*</span><span class="dv">10</span><span class="op">+</span><span class="dv">1</span>, <span class="st">&quot;_&quot;</span>, </a>
<a class="sourceLine" id="cb8-8" data-line-number="8">         <span class="kw">ceiling</span>(var_mod_time<span class="op">$</span>endyear[x]<span class="op">/</span><span class="dv">10</span>)<span class="op">*</span><span class="dv">10</span>, <span class="st">&quot;.nc4&quot;</span>)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">})</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">outfiles &lt;-<span class="st"> </span><span class="kw">unique</span>(var_mod_time<span class="op">$</span>outfile)</a>
<a class="sourceLine" id="cb8-11" data-line-number="11"></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#Create oufile2 list</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13">var_mod_time<span class="op">$</span>outfile2 &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(var_mod_time), <span class="dt">FUN=</span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb8-14" data-line-number="14">  <span class="kw">paste0</span>(filedir, <span class="st">&quot;/ISIMIP2b/DerivedInputData/GCM/global/&quot;</span>, var_mod_time<span class="op">$</span>rcp[x], <span class="st">&quot;/monthly_&quot;</span>, var_mod_time<span class="op">$</span>var[x], <span class="st">&quot;_&quot;</span>, </a>
<a class="sourceLine" id="cb8-15" data-line-number="15">         var_mod_time<span class="op">$</span>model[x], <span class="st">&quot;_&quot;</span>, var_mod_time<span class="op">$</span>rcp[x], <span class="st">&quot;_&quot;</span>, var_mod_time<span class="op">$</span>timeframe[x], <span class="st">&quot;.nc4&quot;</span>)</a>
<a class="sourceLine" id="cb8-16" data-line-number="16">})</a>
<a class="sourceLine" id="cb8-17" data-line-number="17"></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#Run mergeNC for all unique outfiles</span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="kw">lapply</span>(outfiles, <span class="dt">FUN=</span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb8-20" data-line-number="20">  <span class="co"># Subset var_mod_time according to outfiles</span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21">  var_mod_sub &lt;-<span class="st"> </span>var_mod_time[var_mod_time<span class="op">$</span>outfile <span class="op">==</span><span class="st"> </span>x,]</a>
<a class="sourceLine" id="cb8-22" data-line-number="22"></a>
<a class="sourceLine" id="cb8-23" data-line-number="23">  <span class="cf">if</span>(<span class="kw">any</span>(<span class="op">!</span><span class="kw">file.exists</span>(var_mod_sub<span class="op">$</span>outfile2))){</a>
<a class="sourceLine" id="cb8-24" data-line-number="24">    <span class="co"># List ISIMIP2b files</span></a>
<a class="sourceLine" id="cb8-25" data-line-number="25">    files &lt;-<span class="st"> </span>rISIMIP<span class="op">::</span><span class="kw">listISIMIP</span>(<span class="dt">path=</span><span class="kw">paste0</span>(filedir, </a>
<a class="sourceLine" id="cb8-26" data-line-number="26">                                             <span class="st">&quot;/ISIMIP2b/InputData/GCM/&quot;</span>), </a>
<a class="sourceLine" id="cb8-27" data-line-number="27">                                 <span class="dt">var=</span>var_mod_sub<span class="op">$</span>var[<span class="dv">1</span>], </a>
<a class="sourceLine" id="cb8-28" data-line-number="28">                                 <span class="dt">extent=</span><span class="st">&quot;global&quot;</span>, <span class="dt">model=</span>var_mod_sub<span class="op">$</span>model[<span class="dv">1</span>], </a>
<a class="sourceLine" id="cb8-29" data-line-number="29">                                 <span class="dt">scenario=</span>var_mod_sub<span class="op">$</span>rcp[<span class="dv">1</span>], </a>
<a class="sourceLine" id="cb8-30" data-line-number="30">                                 <span class="dt">startyear=</span>var_mod_sub<span class="op">$</span>startyear[<span class="dv">1</span>], <span class="dt">endyear=</span>var_mod_sub<span class="op">$</span>endyear[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb8-31" data-line-number="31">    files &lt;-<span class="st"> </span><span class="kw">Filter</span>(<span class="kw">Negate</span>(is.na), files)</a>
<a class="sourceLine" id="cb8-32" data-line-number="32">    <span class="cf">if</span>(<span class="kw">all</span>(var_mod_sub<span class="op">$</span>startyear <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2006</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">length</span>(files)<span class="op">==</span><span class="dv">4</span>) <span class="op">|</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-33" data-line-number="33"><span class="st">       </span><span class="kw">all</span>(var_mod_sub<span class="op">$</span>startyear <span class="op">&lt;</span><span class="st"> </span><span class="dv">2006</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">length</span>(files) <span class="op">==</span><span class="st"> </span><span class="dv">5</span>) <span class="op">|</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-34" data-line-number="34"><span class="st">       </span><span class="kw">all</span>(var_mod_sub<span class="op">$</span>rcp <span class="op">==</span><span class="st"> &quot;piControl&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">length</span>(files) <span class="op">==</span><span class="st"> </span><span class="dv">4</span>) <span class="op">|</span></a>
<a class="sourceLine" id="cb8-35" data-line-number="35"><span class="st">       </span><span class="kw">all</span>(var_mod_sub<span class="op">$</span>rcp <span class="op">==</span><span class="st"> &quot;historical&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">length</span>(files) <span class="op">==</span><span class="st"> </span><span class="dv">4</span>)){</a>
<a class="sourceLine" id="cb8-36" data-line-number="36">      <span class="cf">if</span>(<span class="op">!</span><span class="kw">file.exists</span>(x)){</a>
<a class="sourceLine" id="cb8-37" data-line-number="37">        processNC<span class="op">::</span><span class="kw">mergeNC</span>(files, x)</a>
<a class="sourceLine" id="cb8-38" data-line-number="38">      }</a>
<a class="sourceLine" id="cb8-39" data-line-number="39">      <span class="co"># Run aggregateNC for all combinations</span></a>
<a class="sourceLine" id="cb8-40" data-line-number="40">      <span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(var_mod_sub), <span class="dt">FUN=</span><span class="cf">function</span>(y){</a>
<a class="sourceLine" id="cb8-41" data-line-number="41">        <span class="cf">if</span>(<span class="op">!</span><span class="kw">file.exists</span>(var_mod_sub<span class="op">$</span>outfile2[y])){</a>
<a class="sourceLine" id="cb8-42" data-line-number="42">          processNC<span class="op">::</span><span class="kw">aggregateNC</span>(<span class="dt">infile=</span>x, <span class="dt">outfile=</span>var_mod_sub<span class="op">$</span>outfile2[y], </a>
<a class="sourceLine" id="cb8-43" data-line-number="43">                                 <span class="dt">var=</span>var_mod_sub<span class="op">$</span>var[y], </a>
<a class="sourceLine" id="cb8-44" data-line-number="44">                      <span class="dt">startdate=</span>var_mod_sub<span class="op">$</span>startyear[y], </a>
<a class="sourceLine" id="cb8-45" data-line-number="45">                      <span class="dt">enddate=</span>var_mod_sub<span class="op">$</span>endyear[y])</a>
<a class="sourceLine" id="cb8-46" data-line-number="46">        }</a>
<a class="sourceLine" id="cb8-47" data-line-number="47">      })</a>
<a class="sourceLine" id="cb8-48" data-line-number="48">      <span class="kw">file.remove</span>(x)</a>
<a class="sourceLine" id="cb8-49" data-line-number="49">    } <span class="cf">else</span>{</a>
<a class="sourceLine" id="cb8-50" data-line-number="50">      <span class="kw">print</span>(files)</a>
<a class="sourceLine" id="cb8-51" data-line-number="51">    }</a>
<a class="sourceLine" id="cb8-52" data-line-number="52">  }</a>
<a class="sourceLine" id="cb8-53" data-line-number="53">})</a>
<a class="sourceLine" id="cb8-54" data-line-number="54"><span class="co">#system(&quot;shutdown -s -f&quot;)</span></a></code></pre></div>
</div>
<div id="transform-climate-data" class="section level2">
<h2>Transform climate data</h2>
<p>First, we make a list of the newly created files:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co">#List all tasmin and tasmax files</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">tmin_files &lt;-<span class="st"> </span><span class="kw">list.files</span>(</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  <span class="kw">paste0</span>(<span class="kw">getwd</span>(), <span class="st">&quot;/ISIMIP2b/DerivedInputData/GCM/global/&quot;</span>),</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">  <span class="dt">pattern=</span><span class="st">&quot;monthly_tasmin_.*</span><span class="ch">\\</span><span class="st">.nc4&quot;</span>, <span class="dt">full.names=</span>T, <span class="dt">recursive=</span>T)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">tmax_files &lt;-<span class="st"> </span><span class="kw">list.files</span>(</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  <span class="kw">paste0</span>(<span class="kw">getwd</span>(), <span class="st">&quot;/ISIMIP2b/DerivedInputData/GCM/global/&quot;</span>), </a>
<a class="sourceLine" id="cb9-7" data-line-number="7">  <span class="dt">pattern=</span><span class="st">&quot;monthly_tasmax_.*</span><span class="ch">\\</span><span class="st">.nc4&quot;</span>, <span class="dt">full.names=</span>T, <span class="dt">recursive=</span>T)</a>
<a class="sourceLine" id="cb9-8" data-line-number="8"></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co"># List precipitation files</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10">prec_files &lt;-<span class="st">  </span><span class="kw">list.files</span>(</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">  <span class="kw">paste0</span>(<span class="kw">getwd</span>(), <span class="st">&quot;/ISIMIP2b/DerivedInputData/GCM/global/&quot;</span>),</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">  <span class="dt">pattern=</span><span class="st">&quot;monthly_pr_.*</span><span class="ch">\\</span><span class="st">.nc4&quot;</span>, <span class="dt">full.names=</span>T, <span class="dt">recursive=</span>T)</a>
<a class="sourceLine" id="cb9-13" data-line-number="13"></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co"># Select certain years</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15">years &lt;-<span class="st"> </span><span class="kw">unique</span>(var_mod_time<span class="op">$</span>timeframe)[<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">4</span><span class="op">:</span><span class="dv">13</span>)]</a>
<a class="sourceLine" id="cb9-16" data-line-number="16"></a>
<a class="sourceLine" id="cb9-17" data-line-number="17">tmin_files &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(years, <span class="cf">function</span>(x) tmin_files[<span class="kw">grep</span>(tmin_files, <span class="dt">pattern=</span>x)]))</a>
<a class="sourceLine" id="cb9-18" data-line-number="18">tmax_files &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(years, <span class="cf">function</span>(x) tmax_files[<span class="kw">grep</span>(tmax_files, <span class="dt">pattern=</span>x)]))</a>
<a class="sourceLine" id="cb9-19" data-line-number="19">prec_files &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(years, <span class="cf">function</span>(x) prec_files[<span class="kw">grep</span>(prec_files, <span class="dt">pattern=</span>x)]))</a>
<a class="sourceLine" id="cb9-20" data-line-number="20">  </a>
<a class="sourceLine" id="cb9-21" data-line-number="21"><span class="co"># Check tmin, tmax and prec files are identical, </span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22"><span class="co">#not just same number of files</span></a></code></pre></div>
<div id="subset-data" class="section level3">
<h3>Subset data</h3>
<p>We want to get global data, but for land only:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># Read landonly mask</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">data</span>(<span class="st">&quot;landseamask_generic&quot;</span>, <span class="dt">package=</span><span class="st">&quot;rISIMIP&quot;</span>)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co"># Mask data by landonly mask</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">tmin_lo &lt;-<span class="st"> </span><span class="kw">lapply</span>(tmin_files, <span class="dt">FUN=</span><span class="cf">function</span>(x) <span class="kw">mask</span>(<span class="kw">stack</span>(x), landseamask_generic))</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">tmax_lo &lt;-<span class="st"> </span><span class="kw">lapply</span>(tmax_files, <span class="dt">FUN=</span><span class="cf">function</span>(x) <span class="kw">mask</span>(<span class="kw">stack</span>(x), landseamask_generic))</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">prec_lo &lt;-<span class="st"> </span><span class="kw">lapply</span>(prec_files, <span class="dt">FUN=</span><span class="cf">function</span>(x) <span class="kw">mask</span>(<span class="kw">stack</span>(x), landseamask_generic))</a>
<a class="sourceLine" id="cb10-9" data-line-number="9"></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="kw">plot</span>(tmin_lo[[<span class="dv">5</span>]])</a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="kw">plot</span>(tmax_lo[[<span class="dv">5</span>]])</a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="kw">plot</span>(prec_lo[[<span class="dv">5</span>]])</a>
<a class="sourceLine" id="cb10-13" data-line-number="13"></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co"># Merge lists into one list</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15">data_lo &lt;-<span class="st"> </span><span class="kw">c</span>(tmin_lo, tmax_lo, prec_lo)</a>
<a class="sourceLine" id="cb10-16" data-line-number="16">data_files &lt;-<span class="st"> </span><span class="kw">c</span>(tmin_files, tmax_files, prec_files)</a>
<a class="sourceLine" id="cb10-17" data-line-number="17"></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co"># Save to file in landonly subfolder</span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="kw">mapply</span>(<span class="dt">FUN=</span><span class="cf">function</span>(x,y){</a>
<a class="sourceLine" id="cb10-20" data-line-number="20">  filename &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot;.nc4&quot;</span>, <span class="st">&quot;_landonly.nc&quot;</span>, <span class="kw">gsub</span>(<span class="st">&quot;global&quot;</span>, <span class="st">&quot;landonly&quot;</span>, y))</a>
<a class="sourceLine" id="cb10-21" data-line-number="21">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">file.exists</span>(<span class="kw">sub</span>(<span class="st">&quot;.nc4&quot;</span>, <span class="st">&quot;.nc&quot;</span>, filename))){</a>
<a class="sourceLine" id="cb10-22" data-line-number="22">    x &lt;-<span class="st"> </span><span class="kw">stack</span>(x)</a>
<a class="sourceLine" id="cb10-23" data-line-number="23">    <span class="co">#x &lt;- as.data.frame(rasterToPoints(x))</span></a>
<a class="sourceLine" id="cb10-24" data-line-number="24">    <span class="co">#colnames(x) &lt;- c(&quot;x&quot;, &quot;y&quot;, month.abb)</span></a>
<a class="sourceLine" id="cb10-25" data-line-number="25">    raster<span class="op">::</span><span class="kw">writeRaster</span>(x, <span class="dt">filename=</span>filename, <span class="dt">format=</span><span class="st">&quot;CDF&quot;</span>,</a>
<a class="sourceLine" id="cb10-26" data-line-number="26">                        <span class="dt">xname=</span><span class="st">&quot;lon&quot;</span>, <span class="dt">yname=</span><span class="st">&quot;lat&quot;</span>, <span class="dt">zname=</span><span class="st">&quot;time&quot;</span>, </a>
<a class="sourceLine" id="cb10-27" data-line-number="27">                        <span class="dt">zunit=</span><span class="st">&quot;years since 1661-1-1 00:00:00&quot;</span>,</a>
<a class="sourceLine" id="cb10-28" data-line-number="28">                        <span class="dt">force_v4=</span><span class="ot">TRUE</span>, <span class="dt">compression=</span><span class="dv">9</span>)</a>
<a class="sourceLine" id="cb10-29" data-line-number="29">  }</a>
<a class="sourceLine" id="cb10-30" data-line-number="30">}, <span class="dt">x=</span>data_lo, <span class="dt">y=</span>data_files)</a>
<a class="sourceLine" id="cb10-31" data-line-number="31"></a>
<a class="sourceLine" id="cb10-32" data-line-number="32"><span class="co"># Change file ending to .nc4</span></a>
<a class="sourceLine" id="cb10-33" data-line-number="33"><span class="kw">lapply</span>(data_files, <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb10-34" data-line-number="34">  <span class="kw">file.rename</span>(<span class="kw">sub</span>(<span class="st">&quot;.nc4&quot;</span>, <span class="st">&quot;_landonly.nc&quot;</span>, </a>
<a class="sourceLine" id="cb10-35" data-line-number="35">                    <span class="kw">gsub</span>(<span class="st">&quot;global&quot;</span>, <span class="st">&quot;landonly&quot;</span>, x)), <span class="kw">sub</span>(<span class="st">&quot;.nc4&quot;</span>, <span class="st">&quot;_landonly.nc4&quot;</span>, </a>
<a class="sourceLine" id="cb10-36" data-line-number="36">                    <span class="kw">gsub</span>(<span class="st">&quot;global&quot;</span>, <span class="st">&quot;landonly&quot;</span>, x)))</a>
<a class="sourceLine" id="cb10-37" data-line-number="37">})</a></code></pre></div>
<div id="change-units" class="section level4">
<h4>Change units</h4>
<p>The climate data comes in non-standard units. Temperature is in Kelvin and needs to be converted to degree Celsius, while precipitation was originally in kg m-2 s-1 and needs to be converted to kg m-2 day-1, which equals mm per day.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co">#Turn climate data into right units (degree Celsius and mm)</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#Convert temperature from Kelvin to degree Celsius</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">tmin_lo &lt;-<span class="st"> </span><span class="kw">lapply</span>(tmin_lo, <span class="dt">FUN=</span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">  raster<span class="op">::</span><span class="kw">calc</span>(x, <span class="dt">fun=</span><span class="cf">function</span>(x){x<span class="fl">-273.15</span>})</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">})</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">tmax_lo &lt;-<span class="st"> </span><span class="kw">lapply</span>(tmax_lo, <span class="dt">FUN=</span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">  raster<span class="op">::</span><span class="kw">calc</span>(x, <span class="dt">fun=</span><span class="cf">function</span>(x){x<span class="fl">-273.15</span>})</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">})</a>
<a class="sourceLine" id="cb11-10" data-line-number="10"></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co"># Convert precipitation from kg m-2 s-1 to kg m-2 day-1</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12">prec_lo &lt;-<span class="st"> </span><span class="kw">lapply</span>(prec_lo, <span class="dt">FUN=</span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb11-13" data-line-number="13">  raster<span class="op">::</span><span class="kw">calc</span>(x, <span class="dt">fun=</span><span class="cf">function</span>(x){x<span class="op">*</span><span class="dv">86400</span>})</a>
<a class="sourceLine" id="cb11-14" data-line-number="14">})</a>
<a class="sourceLine" id="cb11-15" data-line-number="15"></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="kw">plot</span>(tmin_lo[[<span class="dv">1</span>]][[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="kw">plot</span>(tmax_lo[[<span class="dv">1</span>]][[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="kw">plot</span>(prec_lo[[<span class="dv">1</span>]][[<span class="dv">1</span>]])</a></code></pre></div>
</div>
</div>
<div id="calculate-bioclim-variables" class="section level3">
<h3>Calculate Bioclim variables</h3>
<p>From the resulting layers, we can now calculate the Bioclimatic variables, using the biovars function in the dismo package.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co"># Create list with bioclim names</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">bioclim_names &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="dt">x =</span> prec_files, <span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">monthly_pr&quot;</span>, </a>
<a class="sourceLine" id="cb12-5" data-line-number="5">                      <span class="dt">replacement =</span> <span class="st">&quot;bioclim&quot;</span>)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">bioclim_names &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot;.nc4&quot;</span>, <span class="st">&quot;_landonly.nc&quot;</span>, </a>
<a class="sourceLine" id="cb12-7" data-line-number="7">                     <span class="kw">gsub</span>(<span class="st">&quot;global&quot;</span>, <span class="st">&quot;landonly&quot;</span>, bioclim_names))</a>
<a class="sourceLine" id="cb12-8" data-line-number="8"></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co"># Calculate bioclim variables for all models and time frames and save to file</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10">bioclim &lt;-<span class="st"> </span><span class="kw">mapply</span>(<span class="dt">FUN=</span><span class="cf">function</span>(x,y,z,name){</a>
<a class="sourceLine" id="cb12-11" data-line-number="11">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">file.exists</span>(<span class="kw">sub</span>(<span class="st">&quot;.nc4&quot;</span>, <span class="st">&quot;.nc&quot;</span>, name))){</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">    bio &lt;-<span class="st"> </span>dismo<span class="op">::</span><span class="kw">biovars</span>(<span class="dt">tmin=</span>x, <span class="dt">tmax=</span>y, <span class="dt">prec=</span>z)</a>
<a class="sourceLine" id="cb12-13" data-line-number="13">    raster<span class="op">::</span><span class="kw">writeRaster</span>(bio, <span class="dt">filename=</span><span class="kw">sub</span>(<span class="st">&quot;.nc4&quot;</span>, <span class="st">&quot;.nc&quot;</span>, name), <span class="dt">format=</span><span class="st">&quot;CDF&quot;</span>, </a>
<a class="sourceLine" id="cb12-14" data-line-number="14">                        <span class="dt">xname=</span><span class="st">&quot;lon&quot;</span>, <span class="dt">yname=</span><span class="st">&quot;lat&quot;</span>, <span class="dt">zname=</span><span class="st">&quot;time&quot;</span>, </a>
<a class="sourceLine" id="cb12-15" data-line-number="15">                        <span class="dt">zunit=</span><span class="st">&quot;years since 1661-1-1 00:00:00&quot;</span>,</a>
<a class="sourceLine" id="cb12-16" data-line-number="16">                        <span class="dt">force_v4=</span><span class="ot">TRUE</span>, <span class="dt">compression=</span><span class="dv">9</span>)</a>
<a class="sourceLine" id="cb12-17" data-line-number="17">  }</a>
<a class="sourceLine" id="cb12-18" data-line-number="18">}, <span class="dt">x=</span>tmin_lo, <span class="dt">y=</span>tmax_lo, <span class="dt">z=</span>prec_lo, <span class="dt">name=</span>bioclim_names)</a>
<a class="sourceLine" id="cb12-19" data-line-number="19"></a>
<a class="sourceLine" id="cb12-20" data-line-number="20"><span class="co"># Change file name from .nc to .nc4</span></a>
<a class="sourceLine" id="cb12-21" data-line-number="21">bioclim_files &lt;-<span class="st"> </span><span class="kw">list.files</span>(</a>
<a class="sourceLine" id="cb12-22" data-line-number="22">  <span class="kw">paste0</span>(<span class="kw">getwd</span>(), <span class="st">&quot;/ISIMIP2b/DerivedInputData/GCM/landonly&quot;</span>),</a>
<a class="sourceLine" id="cb12-23" data-line-number="23">  <span class="dt">pattern=</span><span class="st">&quot;bioclim_.*</span><span class="ch">\\</span><span class="st">.nc&quot;</span>, <span class="dt">full.names=</span>T, <span class="dt">recursive=</span>T)</a>
<a class="sourceLine" id="cb12-24" data-line-number="24"><span class="co">#lapply(bioclim_files, function(x) raster::extension(x, &quot;.nc4&quot;))</span></a>
<a class="sourceLine" id="cb12-25" data-line-number="25"><span class="kw">file.rename</span>(bioclim_files, <span class="kw">sub</span>(<span class="st">&quot;.nc&quot;</span>, <span class="st">&quot;.nc4&quot;</span>, bioclim_files))</a></code></pre></div>
<p>Now, we can list the previously calculated bioclim files</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">bioclim_files &lt;-<span class="st"> </span><span class="kw">list.files</span>(</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  <span class="kw">paste0</span>(filedir, <span class="st">&quot;/ISIMIP2b/DerivedInputData/GCM/landonly&quot;</span>),</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  <span class="dt">pattern=</span><span class="st">&quot;bioclim_.*</span><span class="ch">\\</span><span class="st">.nc4&quot;</span>, <span class="dt">full.names=</span>T, <span class="dt">recursive=</span>T)</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">bioclim &lt;-<span class="st"> </span><span class="kw">lapply</span>(bioclim_files, raster<span class="op">::</span>stack)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co"># Need to implement bioclim_names here!</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#bioclim_names </span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co"># List internal bioclim files</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">#(bioclim_files &lt;- list.files(&quot;data&quot;, pattern=&quot;bioclim_.*\\landonly.rda&quot;, </span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="co">#                            full.names=T, recursive=T))</span></a></code></pre></div>
</div>
</div>
<div id="data-visualisation" class="section level2">
<h2>Data visualisation</h2>
<div id="ggmap2-package" class="section level3">
<h3>ggmap2 package</h3>
<p>For plotting our data with the <code>createMap</code> function, we need to install the <code>ggmap2</code> package.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># Install ggmap2 package from Github</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;RS-eco/ggmap2&quot;</span>)</a></code></pre></div>
<p>Load ggmap2 package</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">library</span>(ggmap2)</a></code></pre></div>
</div>
<div id="historic-1985-global-landonly-temperature" class="section level3">
<h3>Historic (1985) global landonly temperature</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># Read tas landonly data files</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">tas &lt;-<span class="st"> </span><span class="kw">lapply</span>(</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">  <span class="kw">list.files</span>(<span class="kw">paste0</span>(filedir, <span class="st">&quot;/ISIMIP2b/DerivedInputData/GCM/landonly/historical&quot;</span>), </a>
<a class="sourceLine" id="cb16-4" data-line-number="4">             <span class="dt">pattern=</span><span class="st">&quot;monthly_tas_.*</span><span class="ch">\\</span><span class="st">.nc&quot;</span>, <span class="dt">full.names=</span><span class="ot">TRUE</span>), stack)</a>
<a class="sourceLine" id="cb16-5" data-line-number="5"></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co"># Create Map</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="kw">createMap</span>(tas[[<span class="dv">1</span>]], <span class="dt">name=</span><span class="st">&quot;tas&quot;</span>, <span class="dt">subnames=</span>month.abb, </a>
<a class="sourceLine" id="cb16-8" data-line-number="8">          <span class="dt">split=</span><span class="ot">FALSE</span>, <span class="dt">ncol=</span><span class="dv">3</span>, <span class="dt">width=</span><span class="dv">12</span>, <span class="dt">height=</span><span class="dv">8</span>, <span class="dt">units=</span><span class="st">&quot;in&quot;</span>, <span class="dt">dpi=</span><span class="dv">100</span>)</a></code></pre></div>
</div>
<div id="plot-bioclim-data" class="section level3">
<h3>Plot Bioclim data</h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co"># Read Bioclim data files</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2">bioclim_<span class="dv">2050</span> &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">list.files</span>(<span class="kw">paste0</span>(filedir, <span class="st">&quot;ISIMIP2b/ProcessedData/bioclim&quot;</span>),</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">                                  <span class="dt">pattern=</span><span class="st">&quot;rcp_2050.nc&quot;</span>, <span class="dt">full.names=</span><span class="ot">TRUE</span>), stack)</a>
<a class="sourceLine" id="cb17-4" data-line-number="4"></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="co"># Create Map of bioclim data</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6">bio04_<span class="dv">2050</span> &lt;-<span class="st"> </span><span class="kw">stack</span>(<span class="kw">lapply</span>(bioclim_<span class="dv">2050</span>, <span class="cf">function</span>(x) x[[<span class="dv">4</span>]]))</a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="kw">createMap</span>(bioclim[[<span class="dv">20</span>]][[<span class="dv">4</span>]], <span class="dt">name=</span><span class="st">&quot;Bio04&quot;</span>, <span class="dt">split=</span><span class="ot">FALSE</span>, <span class="dt">ncol=</span><span class="dv">2</span>, <span class="dt">width=</span><span class="dv">8</span>, <span class="dt">height=</span><span class="dv">12</span>, <span class="dt">units=</span><span class="st">&quot;in&quot;</span>, <span class="dt">filename=</span><span class="ot">NA</span>, <span class="dt">dpi=</span><span class="dv">100</span>)</a></code></pre></div>
</div>
<div id="plot-all-climate-data-and-save-to-file" class="section level3">
<h3>Plot all climate data and save to file</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">tmax_files &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;/media/matt/Data/Documents/Wissenschaft/Data/ISIMIP2b/DerivedInputData/30yr_climate/&quot;</span>, <span class="dt">pattern=</span><span class="st">&quot;monthly_tasmax_.*</span><span class="ch">\\</span><span class="st">.nc&quot;</span>, <span class="dt">full.names=</span><span class="ot">TRUE</span>, <span class="dt">recursive=</span>T)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(tmax_files)){</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">  tasmax &lt;-<span class="st"> </span><span class="kw">stack</span>(tmax_files[i])</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">  tasmax_df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">rasterToPoints</span>(tasmax))</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">  <span class="kw">colnames</span>(tasmax_df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, month.abb)</a>
<a class="sourceLine" id="cb18-7" data-line-number="7">  <span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_raster</span>(<span class="dt">data=</span>tasmax_df, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">fill=</span>Jul)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="st">    </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colours=</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9">                           <span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&quot;#00007F&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;#007FFF&quot;</span>, <span class="st">&quot;cyan&quot;</span>,</a>
<a class="sourceLine" id="cb18-10" data-line-number="10">                                              <span class="st">&quot;#7FFF7F&quot;</span>, <span class="st">&quot;yellow&quot;</span>, </a>
<a class="sourceLine" id="cb18-11" data-line-number="11">                                              <span class="st">&quot;#FF7F00&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;#7F0000&quot;</span>))(<span class="dv">255</span>))</a>
<a class="sourceLine" id="cb18-12" data-line-number="12">  <span class="kw">ggsave</span>(<span class="kw">sub</span>(<span class="dt">pattern=</span><span class="st">&quot;.grd&quot;</span>, <span class="st">&quot;.png&quot;</span>, tmax_files[i]))</a>
<a class="sourceLine" id="cb18-13" data-line-number="13">  readr<span class="op">::</span><span class="kw">write_csv</span>(tasmax_df, <span class="kw">sub</span>(<span class="dt">pattern=</span><span class="st">&quot;.grd&quot;</span>, <span class="st">&quot;.csv&quot;</span>, tmax_files[i]))</a>
<a class="sourceLine" id="cb18-14" data-line-number="14">}</a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="kw">file.remove</span>(tmax_files)</a>
<a class="sourceLine" id="cb18-16" data-line-number="16"><span class="kw">file.remove</span>(<span class="kw">sub</span>(<span class="dt">pattern=</span><span class="st">&quot;.grd&quot;</span>, <span class="st">&quot;.gri&quot;</span>, tmax_files))</a>
<a class="sourceLine" id="cb18-17" data-line-number="17"></a>
<a class="sourceLine" id="cb18-18" data-line-number="18">bioclim_files &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;/media/matt/Data/Documents/Wissenschaft/Data/ISIMIP2b/DerivedInputData/30yr_climate/rcp85&quot;</span>,</a>
<a class="sourceLine" id="cb18-19" data-line-number="19">                            <span class="dt">pattern=</span><span class="st">&quot;bioclim_.*</span><span class="ch">\\</span><span class="st">.nc4&quot;</span>, <span class="dt">full.names=</span><span class="ot">TRUE</span>, <span class="dt">recursive=</span>T)</a>
<a class="sourceLine" id="cb18-20" data-line-number="20"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(bioclim_files)){</a>
<a class="sourceLine" id="cb18-21" data-line-number="21">  bioclim &lt;-<span class="st"> </span><span class="kw">stack</span>(bioclim_files[i])</a>
<a class="sourceLine" id="cb18-22" data-line-number="22">  bioclim_df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">rasterToPoints</span>(bioclim))</a>
<a class="sourceLine" id="cb18-23" data-line-number="23">    <span class="kw">colnames</span>(bioclim_df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;bio&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">19</span>))</a>
<a class="sourceLine" id="cb18-24" data-line-number="24">    <span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_tile</span>(<span class="dt">data=</span>bioclim_df, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">fill=</span>bio5)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-25" data-line-number="25"><span class="st">    </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colours=</span></a>
<a class="sourceLine" id="cb18-26" data-line-number="26">                           <span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&quot;#00007F&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;#007FFF&quot;</span>, <span class="st">&quot;cyan&quot;</span>,</a>
<a class="sourceLine" id="cb18-27" data-line-number="27">                                              <span class="st">&quot;#7FFF7F&quot;</span>, <span class="st">&quot;yellow&quot;</span>, </a>
<a class="sourceLine" id="cb18-28" data-line-number="28">                                              <span class="st">&quot;#FF7F00&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;#7F0000&quot;</span>))(<span class="dv">255</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-29" data-line-number="29"><span class="st">      </span><span class="kw">geom_sf</span>()</a>
<a class="sourceLine" id="cb18-30" data-line-number="30">  <span class="kw">ggsave</span>(<span class="kw">sub</span>(<span class="dt">pattern=</span><span class="st">&quot;.nc4&quot;</span>, <span class="st">&quot;.png&quot;</span>, bioclim_files[i]))</a>
<a class="sourceLine" id="cb18-31" data-line-number="31">  readr<span class="op">::</span><span class="kw">write_csv</span>(bioclim_df, <span class="kw">sub</span>(<span class="dt">pattern=</span><span class="st">&quot;.nc4&quot;</span>, <span class="st">&quot;.csv.xz&quot;</span>, bioclim_files[i]))</a>
<a class="sourceLine" id="cb18-32" data-line-number="32">}</a>
<a class="sourceLine" id="cb18-33" data-line-number="33"><span class="kw">file.remove</span>(bioclim_files)</a></code></pre></div>
</div>
</div>
<div id="plot-change-in-climate" class="section level2">
<h2>Plot change in climate</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">bioclim_<span class="dv">1995</span> &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">list.files</span>(</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">  <span class="kw">paste0</span>(filedir, <span class="st">&quot;/ISIMIP2b/DerivedInputData/GCM/landonly&quot;</span>),</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">  <span class="dt">pattern=</span><span class="st">&quot;bioclim_EWEMBI.*</span><span class="ch">\\</span><span class="st">.nc&quot;</span>, </a>
<a class="sourceLine" id="cb19-4" data-line-number="4">  <span class="dt">full.names=</span>T, <span class="dt">recursive=</span>T))[,<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;bio4&quot;</span>, <span class="st">&quot;bio5&quot;</span>, <span class="st">&quot;bio12&quot;</span>, <span class="st">&quot;bio15&quot;</span>, <span class="st">&quot;bio18&quot;</span>, <span class="st">&quot;bio19&quot;</span>)]</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">bioclim_<span class="dv">1995</span><span class="op">$</span>year &lt;-<span class="st"> </span><span class="dv">1995</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6">bioclim_<span class="dv">1995</span> &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw">gather</span>(bioclim_<span class="dv">1995</span>, var, value, <span class="op">-</span><span class="kw">c</span>(x,y,year))</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">bioclim_<span class="dv">1995</span> &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw">spread</span>(bioclim_<span class="dv">1995</span>, year, value)</a>
<a class="sourceLine" id="cb19-8" data-line-number="8"></a>
<a class="sourceLine" id="cb19-9" data-line-number="9">bioclim_fut &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">list.files</span>(</a>
<a class="sourceLine" id="cb19-10" data-line-number="10">  <span class="kw">paste0</span>(filedir, <span class="st">&quot;/ISIMIP2b/DerivedInputData/GCM/landonly&quot;</span>),</a>
<a class="sourceLine" id="cb19-11" data-line-number="11">  <span class="dt">pattern=</span><span class="st">&quot;bioclim_.*2050.*</span><span class="ch">\\</span><span class="st">.csv.xz&quot;</span>, <span class="dt">full.names=</span>T, <span class="dt">recursive=</span>T), <span class="kw">list.files</span>(</a>
<a class="sourceLine" id="cb19-12" data-line-number="12">    <span class="kw">paste0</span>(filedir, <span class="st">&quot;/ISIMIP2b/DerivedInputData/GCM/landonly&quot;</span>),</a>
<a class="sourceLine" id="cb19-13" data-line-number="13">    <span class="dt">pattern=</span><span class="st">&quot;bioclim_.*2080.*</span><span class="ch">\\</span><span class="st">.csv.xz&quot;</span>, <span class="dt">full.names=</span>T, <span class="dt">recursive=</span>T))</a>
<a class="sourceLine" id="cb19-14" data-line-number="14">bioclim_fut &lt;-<span class="st"> </span><span class="kw">lapply</span>(bioclim_fut, <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb19-15" data-line-number="15">  data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(x)</a>
<a class="sourceLine" id="cb19-16" data-line-number="16">  data<span class="op">$</span>year &lt;-<span class="st"> </span><span class="kw">strsplit</span>(<span class="kw">basename</span>(x), <span class="dt">split=</span><span class="st">&quot;_&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">4</span>]</a>
<a class="sourceLine" id="cb19-17" data-line-number="17">  data<span class="op">$</span>model &lt;-<span class="st"> </span><span class="kw">strsplit</span>(<span class="kw">basename</span>(x), <span class="dt">split=</span><span class="st">&quot;_&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb19-18" data-line-number="18">  data<span class="op">$</span>scenario &lt;-<span class="st"> </span><span class="kw">strsplit</span>(<span class="kw">basename</span>(x), <span class="dt">split=</span><span class="st">&quot;_&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb19-19" data-line-number="19">  <span class="kw">return</span>(data)</a>
<a class="sourceLine" id="cb19-20" data-line-number="20">})</a>
<a class="sourceLine" id="cb19-21" data-line-number="21">bioclim_fut &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, bioclim_fut)</a>
<a class="sourceLine" id="cb19-22" data-line-number="22"></a>
<a class="sourceLine" id="cb19-23" data-line-number="23"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb19-24" data-line-number="24">bioclim_fut &lt;-<span class="st"> </span>bioclim_fut <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-25" data-line-number="25"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="kw">c</span>(x,y,model,scenario,year,bio4,bio5,bio12,bio15,bio18,bio19))</a>
<a class="sourceLine" id="cb19-26" data-line-number="26">bioclim_fut &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw">gather</span>(bioclim_fut, var, value, <span class="op">-</span><span class="kw">c</span>(x,y,model,scenario,year))</a>
<a class="sourceLine" id="cb19-27" data-line-number="27">bioclim_fut &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw">spread</span>(bioclim_fut, year, value)</a>
<a class="sourceLine" id="cb19-28" data-line-number="28"></a>
<a class="sourceLine" id="cb19-29" data-line-number="29"><span class="co"># Calculate delta climate</span></a>
<a class="sourceLine" id="cb19-30" data-line-number="30">bioclim_all &lt;-<span class="st"> </span><span class="kw">left_join</span>(bioclim_fut, bioclim_<span class="dv">1995</span>, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;var&quot;</span>))</a>
<a class="sourceLine" id="cb19-31" data-line-number="31">delta_climate &lt;-<span class="st"> </span>bioclim_all <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-32" data-line-number="32"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="st">`</span><span class="dt">2050</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2080</span><span class="st">`</span>), <span class="kw">funs</span>(. <span class="op">-</span><span class="st"> </span>bioclim_all<span class="op">$</span><span class="st">`</span><span class="dt">1995</span><span class="st">`</span>)) <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(<span class="st">`</span><span class="dt">1995</span><span class="st">`</span>))</a>
<a class="sourceLine" id="cb19-33" data-line-number="33">delta_climate &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw">gather</span>(delta_climate, year, value, <span class="op">-</span><span class="kw">c</span>(x,y,model,scenario,var))</a>
<a class="sourceLine" id="cb19-34" data-line-number="34">delta_climate &lt;-<span class="st"> </span>delta_climate <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(x,y,scenario,var, year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-35" data-line-number="35"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">value=</span><span class="kw">mean</span>(value, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb19-36" data-line-number="36"></a>
<a class="sourceLine" id="cb19-37" data-line-number="37"><span class="co">#Subset data for plotting</span></a>
<a class="sourceLine" id="cb19-38" data-line-number="38"><span class="kw">lapply</span>(<span class="kw">c</span>(<span class="st">&quot;2050&quot;</span>, <span class="st">&quot;2080&quot;</span>), <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb19-39" data-line-number="39">  climate &lt;-<span class="st"> </span>delta_climate[delta_climate<span class="op">$</span>year <span class="op">==</span><span class="st"> </span>x,]</a>
<a class="sourceLine" id="cb19-40" data-line-number="40">  climate &lt;-<span class="st"> </span>climate <span class="op">%&gt;%</span><span class="st"> </span>tidyr<span class="op">::</span><span class="kw">unite</span>(year, scenario, <span class="dt">col=</span><span class="st">&quot;time_rcp&quot;</span>)</a>
<a class="sourceLine" id="cb19-41" data-line-number="41">  climate<span class="op">$</span>time_rcp &lt;-<span class="st"> </span><span class="kw">factor</span>(climate<span class="op">$</span>time_rcp, <span class="dt">labels=</span><span class="kw">c</span>(<span class="kw">paste0</span>(x, <span class="st">&quot; RCP2.6&quot;</span>), </a>
<a class="sourceLine" id="cb19-42" data-line-number="42">                                                        <span class="kw">paste0</span>(x, <span class="st">&quot; RCP6.0&quot;</span>)))</a>
<a class="sourceLine" id="cb19-43" data-line-number="43">  <span class="kw">data</span>(outline, <span class="dt">package=</span><span class="st">&quot;ggmap2&quot;</span>)</a>
<a class="sourceLine" id="cb19-44" data-line-number="44">  <span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb19-45" data-line-number="45">  p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-46" data-line-number="46"><span class="st">    </span><span class="kw">geom_raster</span>(<span class="dt">data=</span>climate[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio4&quot;</span>,], <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">fill=</span>value)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-47" data-line-number="47"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>time_rcp, <span class="dt">ncol=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-48" data-line-number="48"><span class="st">    </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>outline, <span class="kw">aes</span>(<span class="dt">x=</span>long,<span class="dt">y=</span>lat, <span class="dt">group=</span>group), </a>
<a class="sourceLine" id="cb19-49" data-line-number="49">                 <span class="dt">fill=</span><span class="st">&quot;transparent&quot;</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-50" data-line-number="50"><span class="st">    </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">name=</span><span class="st">&quot;Temperature </span><span class="ch">\n</span><span class="st">seasonality&quot;</span>, <span class="dt">colours=</span><span class="kw">rev</span>(<span class="kw">colorRampPalette</span>(</a>
<a class="sourceLine" id="cb19-51" data-line-number="51">      <span class="kw">c</span>(<span class="st">&quot;#00007F&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;#007FFF&quot;</span>, <span class="st">&quot;cyan&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;yellow&quot;</span>, </a>
<a class="sourceLine" id="cb19-52" data-line-number="52">        <span class="st">&quot;#FF7F00&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;#7F0000&quot;</span>))(<span class="dv">255</span>)), <span class="dt">values=</span>scales<span class="op">::</span><span class="kw">rescale</span>(<span class="kw">unique</span>(<span class="kw">c</span>(<span class="kw">seq</span>(<span class="kw">min</span>(climate<span class="op">$</span>value[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio4&quot;</span>]), <span class="dv">0</span>, <span class="dt">length=</span><span class="dv">5</span>), <span class="kw">seq</span>(<span class="dv">0</span>, <span class="kw">max</span>(climate<span class="op">$</span>value[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio4&quot;</span>]), <span class="dt">length=</span><span class="dv">5</span>)))), <span class="dt">na.value=</span><span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-53" data-line-number="53"><span class="st">    </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.line =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-54" data-line-number="54">                            <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-55" data-line-number="55">                            <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(), </a>
<a class="sourceLine" id="cb19-56" data-line-number="56">                            <span class="dt">strip.background=</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-57" data-line-number="57">                            <span class="dt">strip.placement =</span> <span class="st">&quot;outside&quot;</span>, </a>
<a class="sourceLine" id="cb19-58" data-line-number="58">                            <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">10</span>, <span class="dt">face=</span><span class="st">&quot;bold&quot;</span>),</a>
<a class="sourceLine" id="cb19-59" data-line-number="59">                            <span class="dt">rect =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-60" data-line-number="60"><span class="st">    </span><span class="kw">coord_quickmap</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">180</span>,<span class="dv">180</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">60</span>,<span class="dv">85</span>), <span class="dt">expand=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb19-61" data-line-number="61">  p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-62" data-line-number="62"><span class="st">    </span><span class="kw">geom_raster</span>(<span class="dt">data=</span>climate[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio12&quot;</span>,], <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">fill=</span>value)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-63" data-line-number="63"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>time_rcp, <span class="dt">ncol=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-64" data-line-number="64"><span class="st">    </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>outline, <span class="kw">aes</span>(<span class="dt">x=</span>long,<span class="dt">y=</span>lat, <span class="dt">group=</span>group), </a>
<a class="sourceLine" id="cb19-65" data-line-number="65">                 <span class="dt">fill=</span><span class="st">&quot;transparent&quot;</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-66" data-line-number="66"><span class="st">    </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">name=</span><span class="st">&quot;Annual </span><span class="ch">\n</span><span class="st">precipitation&quot;</span>, <span class="dt">colours=</span><span class="kw">colorRampPalette</span>(</a>
<a class="sourceLine" id="cb19-67" data-line-number="67">      <span class="kw">c</span>(<span class="st">&quot;#00007F&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;#007FFF&quot;</span>, <span class="st">&quot;cyan&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;yellow&quot;</span>, </a>
<a class="sourceLine" id="cb19-68" data-line-number="68">        <span class="st">&quot;#FF7F00&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;#7F0000&quot;</span>))(<span class="dv">255</span>),</a>
<a class="sourceLine" id="cb19-69" data-line-number="69">      <span class="dt">values=</span>scales<span class="op">::</span><span class="kw">rescale</span>(<span class="kw">unique</span>(<span class="kw">c</span>(<span class="kw">seq</span>(<span class="kw">min</span>(climate<span class="op">$</span>value[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio12&quot;</span>]), </a>
<a class="sourceLine" id="cb19-70" data-line-number="70">                                          <span class="dv">0</span>, <span class="dt">length=</span><span class="dv">5</span>), <span class="kw">seq</span>(<span class="dv">0</span>, <span class="kw">max</span>(climate<span class="op">$</span>value[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio12&quot;</span>]), <span class="dt">length=</span><span class="dv">5</span>)))), <span class="dt">na.value=</span><span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-71" data-line-number="71"><span class="st">    </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),<span class="dt">axis.line =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-72" data-line-number="72">                            <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-73" data-line-number="73">                            <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(), </a>
<a class="sourceLine" id="cb19-74" data-line-number="74">                            <span class="dt">strip.background=</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-75" data-line-number="75">                            <span class="dt">strip.placement =</span> <span class="st">&quot;outside&quot;</span>, </a>
<a class="sourceLine" id="cb19-76" data-line-number="76">                            <span class="dt">strip.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-77" data-line-number="77">                            <span class="dt">rect =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-78" data-line-number="78"><span class="st">    </span><span class="kw">coord_quickmap</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">180</span>,<span class="dv">180</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">60</span>,<span class="dv">85</span>), <span class="dt">expand=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb19-79" data-line-number="79">  p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-80" data-line-number="80"><span class="st">    </span><span class="kw">geom_raster</span>(<span class="dt">data=</span>climate[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio19&quot;</span>,], <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">fill=</span>value)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-81" data-line-number="81"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>time_rcp, <span class="dt">ncol=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-82" data-line-number="82"><span class="st">    </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>outline, <span class="kw">aes</span>(<span class="dt">x=</span>long,<span class="dt">y=</span>lat, <span class="dt">group=</span>group), </a>
<a class="sourceLine" id="cb19-83" data-line-number="83">                 <span class="dt">fill=</span><span class="st">&quot;transparent&quot;</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-84" data-line-number="84"><span class="st">    </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">name=</span><span class="st">&quot;Precipitation </span><span class="ch">\n</span><span class="st">of coldest </span><span class="ch">\n</span><span class="st">quarter&quot;</span>, </a>
<a class="sourceLine" id="cb19-85" data-line-number="85">                         <span class="dt">colours=</span><span class="kw">colorRampPalette</span>(</a>
<a class="sourceLine" id="cb19-86" data-line-number="86">                           <span class="kw">c</span>(<span class="st">&quot;#00007F&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;#007FFF&quot;</span>, <span class="st">&quot;cyan&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;yellow&quot;</span>, </a>
<a class="sourceLine" id="cb19-87" data-line-number="87">                             <span class="st">&quot;#FF7F00&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;#7F0000&quot;</span>))(<span class="dv">255</span>), <span class="dt">values=</span>scales<span class="op">::</span><span class="kw">rescale</span>(<span class="kw">unique</span>(<span class="kw">c</span>(<span class="kw">seq</span>(<span class="kw">min</span>(climate<span class="op">$</span>value[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio19&quot;</span>]), <span class="dv">0</span>, <span class="dt">length=</span><span class="dv">5</span>), <span class="kw">seq</span>(<span class="dv">0</span>, <span class="kw">max</span>(climate<span class="op">$</span>value[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio19&quot;</span>]), <span class="dt">length=</span><span class="dv">5</span>)))), <span class="dt">na.value=</span><span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-88" data-line-number="88"><span class="st">    </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),<span class="dt">axis.line =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-89" data-line-number="89">                            <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-90" data-line-number="90">                            <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-91" data-line-number="91">                            <span class="dt">strip.background=</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-92" data-line-number="92">                            <span class="dt">strip.placement =</span> <span class="st">&quot;outside&quot;</span>, <span class="dt">strip.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-93" data-line-number="93">                            <span class="dt">rect =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-94" data-line-number="94"><span class="st">    </span><span class="kw">coord_quickmap</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">180</span>,<span class="dv">180</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">60</span>,<span class="dv">85</span>), <span class="dt">expand=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb19-95" data-line-number="95">  </a>
<a class="sourceLine" id="cb19-96" data-line-number="96">  <span class="co"># Turn plots into grob elements</span></a>
<a class="sourceLine" id="cb19-97" data-line-number="97">  p &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">list</span>(p1,p2,p3), ggplotGrob)</a>
<a class="sourceLine" id="cb19-98" data-line-number="98">  p &lt;-<span class="st"> </span><span class="kw">rbind</span>(p[[<span class="dv">1</span>]], p[[<span class="dv">2</span>]], p[[<span class="dv">3</span>]], <span class="dt">size=</span><span class="st">&quot;first&quot;</span>)</a>
<a class="sourceLine" id="cb19-99" data-line-number="99">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">which</span>(p<span class="op">$</span>layout<span class="op">$</span>name <span class="op">==</span><span class="st"> &quot;guide-box&quot;</span>)) {</a>
<a class="sourceLine" id="cb19-100" data-line-number="100">    p<span class="op">$</span>grobs[[i]] &lt;-<span class="st"> </span>p<span class="op">$</span>grobs[[i]]<span class="op">$</span>grobs[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb19-101" data-line-number="101">  }</a>
<a class="sourceLine" id="cb19-102" data-line-number="102">  <span class="kw">png</span>(<span class="dt">file=</span><span class="kw">paste0</span>(<span class="st">&quot;figures/top_clim_change_&quot;</span>, x, <span class="st">&quot;.png&quot;</span>), </a>
<a class="sourceLine" id="cb19-103" data-line-number="103">      <span class="dt">width=</span><span class="dv">10</span>, <span class="dt">height=</span><span class="dv">6</span>, <span class="dt">unit=</span><span class="st">&quot;in&quot;</span>, <span class="dt">res=</span><span class="dv">600</span>)</a>
<a class="sourceLine" id="cb19-104" data-line-number="104">  grid<span class="op">::</span><span class="kw">grid.draw</span>(p)</a>
<a class="sourceLine" id="cb19-105" data-line-number="105">  <span class="kw">dev.off</span>()</a>
<a class="sourceLine" id="cb19-106" data-line-number="106">})</a>
<a class="sourceLine" id="cb19-107" data-line-number="107"></a>
<a class="sourceLine" id="cb19-108" data-line-number="108"><span class="kw">lapply</span>(<span class="kw">c</span>(<span class="st">&quot;2050&quot;</span>, <span class="st">&quot;2080&quot;</span>), <span class="cf">function</span>(time){</a>
<a class="sourceLine" id="cb19-109" data-line-number="109">  climate &lt;-<span class="st"> </span>delta_climate[delta_climate<span class="op">$</span>year <span class="op">==</span><span class="st"> </span>time,]</a>
<a class="sourceLine" id="cb19-110" data-line-number="110">  climate &lt;-<span class="st"> </span>climate <span class="op">%&gt;%</span><span class="st"> </span>tidyr<span class="op">::</span><span class="kw">unite</span>(year, scenario, <span class="dt">col=</span><span class="st">&quot;time_rcp&quot;</span>)</a>
<a class="sourceLine" id="cb19-111" data-line-number="111">  climate<span class="op">$</span>time_rcp &lt;-<span class="st"> </span><span class="kw">factor</span>(climate<span class="op">$</span>time_rcp, <span class="dt">labels=</span><span class="kw">c</span>(<span class="kw">paste0</span>(time, <span class="st">&quot; RCP2.6&quot;</span>), </a>
<a class="sourceLine" id="cb19-112" data-line-number="112">                                                        <span class="kw">paste0</span>(time, <span class="st">&quot; RCP6.0&quot;</span>)))</a>
<a class="sourceLine" id="cb19-113" data-line-number="113">  <span class="kw">data</span>(outline, <span class="dt">package=</span><span class="st">&quot;ggmap2&quot;</span>)</a>
<a class="sourceLine" id="cb19-114" data-line-number="114">  <span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb19-115" data-line-number="115">  p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-116" data-line-number="116"><span class="st">    </span><span class="kw">geom_raster</span>(<span class="dt">data=</span>climate[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio5&quot;</span>,], <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">fill=</span>value)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-117" data-line-number="117"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>time_rcp, <span class="dt">ncol=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-118" data-line-number="118"><span class="st">    </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>outline, <span class="kw">aes</span>(<span class="dt">x=</span>long,<span class="dt">y=</span>lat, <span class="dt">group=</span>group), </a>
<a class="sourceLine" id="cb19-119" data-line-number="119">                 <span class="dt">fill=</span><span class="st">&quot;transparent&quot;</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-120" data-line-number="120"><span class="st">    </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">name=</span><span class="st">&quot;Maximum </span><span class="ch">\n</span><span class="st">temperature&quot;</span>, <span class="dt">colours=</span><span class="kw">rev</span>(<span class="kw">colorRampPalette</span>(</a>
<a class="sourceLine" id="cb19-121" data-line-number="121">      <span class="kw">c</span>(<span class="st">&quot;#00007F&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;#007FFF&quot;</span>, <span class="st">&quot;cyan&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;yellow&quot;</span>, </a>
<a class="sourceLine" id="cb19-122" data-line-number="122">        <span class="st">&quot;#FF7F00&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;#7F0000&quot;</span>))(<span class="dv">255</span>)),</a>
<a class="sourceLine" id="cb19-123" data-line-number="123">      <span class="dt">values=</span>scales<span class="op">::</span><span class="kw">rescale</span>(<span class="kw">unique</span>(<span class="kw">c</span>(<span class="kw">seq</span>(<span class="kw">min</span>(climate<span class="op">$</span>value[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio5&quot;</span>]), <span class="dv">0</span>, <span class="dt">length=</span><span class="dv">5</span>), <span class="kw">seq</span>(<span class="dv">0</span>, <span class="kw">max</span>(climate<span class="op">$</span>value[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio5&quot;</span>]), <span class="dt">length=</span><span class="dv">5</span>)))), <span class="dt">na.value=</span><span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-124" data-line-number="124"><span class="st">    </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),<span class="dt">axis.line =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-125" data-line-number="125">                            <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-126" data-line-number="126">                            <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.background=</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-127" data-line-number="127">                            <span class="dt">strip.placement =</span> <span class="st">&quot;outside&quot;</span>, <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">10</span>, <span class="dt">face=</span><span class="st">&quot;bold&quot;</span>),</a>
<a class="sourceLine" id="cb19-128" data-line-number="128">                            <span class="dt">rect =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-129" data-line-number="129"><span class="st">    </span><span class="kw">coord_quickmap</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">180</span>,<span class="dv">180</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">60</span>,<span class="dv">85</span>), <span class="dt">expand=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb19-130" data-line-number="130">  p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-131" data-line-number="131"><span class="st">    </span><span class="kw">geom_raster</span>(<span class="dt">data=</span>climate[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio15&quot;</span>,], <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">fill=</span>value)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-132" data-line-number="132"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>time_rcp, <span class="dt">ncol=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-133" data-line-number="133"><span class="st">    </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>outline, <span class="kw">aes</span>(<span class="dt">x=</span>long,<span class="dt">y=</span>lat, <span class="dt">group=</span>group), </a>
<a class="sourceLine" id="cb19-134" data-line-number="134">                 <span class="dt">fill=</span><span class="st">&quot;transparent&quot;</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-135" data-line-number="135"><span class="st">    </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">name=</span><span class="st">&quot;Precipitation </span><span class="ch">\n</span><span class="st">seasonality&quot;</span>, <span class="dt">colours=</span><span class="kw">colorRampPalette</span>(</a>
<a class="sourceLine" id="cb19-136" data-line-number="136">      <span class="kw">c</span>(<span class="st">&quot;#00007F&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;#007FFF&quot;</span>, <span class="st">&quot;cyan&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;yellow&quot;</span>, </a>
<a class="sourceLine" id="cb19-137" data-line-number="137">        <span class="st">&quot;#FF7F00&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;#7F0000&quot;</span>))(<span class="dv">255</span>), <span class="dt">values=</span>scales<span class="op">::</span><span class="kw">rescale</span>(<span class="kw">unique</span>(<span class="kw">c</span>(<span class="kw">seq</span>(<span class="kw">min</span>(climate<span class="op">$</span>value[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio15&quot;</span>]), <span class="dv">0</span>, <span class="dt">length=</span><span class="dv">5</span>), <span class="kw">seq</span>(<span class="dv">0</span>, <span class="kw">max</span>(climate<span class="op">$</span>value[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio15&quot;</span>]), <span class="dt">length=</span><span class="dv">5</span>)))), <span class="dt">na.value=</span><span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-138" data-line-number="138"><span class="st">    </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),<span class="dt">axis.line =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-139" data-line-number="139">                            <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-140" data-line-number="140">                            <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.background=</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-141" data-line-number="141">                            <span class="dt">strip.placement =</span> <span class="st">&quot;outside&quot;</span>, <span class="dt">strip.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-142" data-line-number="142">                            <span class="dt">rect =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-143" data-line-number="143"><span class="st">    </span><span class="kw">coord_quickmap</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">180</span>,<span class="dv">180</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">60</span>,<span class="dv">85</span>), <span class="dt">expand=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb19-144" data-line-number="144">  p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-145" data-line-number="145"><span class="st">    </span><span class="kw">geom_raster</span>(<span class="dt">data=</span>climate[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio18&quot;</span>,], <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">fill=</span>value)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-146" data-line-number="146"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>time_rcp, <span class="dt">ncol=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-147" data-line-number="147"><span class="st">    </span><span class="kw">geom_polygon</span>(<span class="dt">data=</span>outline, <span class="kw">aes</span>(<span class="dt">x=</span>long,<span class="dt">y=</span>lat, <span class="dt">group=</span>group), </a>
<a class="sourceLine" id="cb19-148" data-line-number="148">                 <span class="dt">fill=</span><span class="st">&quot;transparent&quot;</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-149" data-line-number="149"><span class="st">    </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">name=</span><span class="st">&quot;Precipitation </span><span class="ch">\n</span><span class="st">of warmest </span><span class="ch">\n</span><span class="st">quarter&quot;</span>, </a>
<a class="sourceLine" id="cb19-150" data-line-number="150">                         <span class="dt">colours=</span><span class="kw">colorRampPalette</span>(</a>
<a class="sourceLine" id="cb19-151" data-line-number="151">                           <span class="kw">c</span>(<span class="st">&quot;#00007F&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;#007FFF&quot;</span>, <span class="st">&quot;cyan&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;yellow&quot;</span>, </a>
<a class="sourceLine" id="cb19-152" data-line-number="152">                             <span class="st">&quot;#FF7F00&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;#7F0000&quot;</span>))(<span class="dv">255</span>), <span class="dt">values=</span>scales<span class="op">::</span><span class="kw">rescale</span>(<span class="kw">unique</span>(<span class="kw">c</span>(<span class="kw">seq</span>(<span class="kw">min</span>(climate<span class="op">$</span>value[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio18&quot;</span>]), <span class="dv">0</span>, <span class="dt">length=</span><span class="dv">5</span>), <span class="kw">seq</span>(<span class="dv">0</span>, <span class="kw">max</span>(climate<span class="op">$</span>value[climate<span class="op">$</span>var <span class="op">==</span><span class="st"> &quot;bio18&quot;</span>]), <span class="dt">length=</span><span class="dv">5</span>)))), <span class="dt">na.value=</span><span class="st">&quot;transparent&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-153" data-line-number="153"><span class="st">    </span><span class="kw">theme_classic</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),<span class="dt">axis.line =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-154" data-line-number="154">                            <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-155" data-line-number="155">                            <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(), <span class="dt">strip.background=</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-156" data-line-number="156">                            <span class="dt">strip.placement =</span> <span class="st">&quot;outside&quot;</span>, <span class="dt">strip.text =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb19-157" data-line-number="157">                            <span class="dt">rect =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-158" data-line-number="158"><span class="st">    </span><span class="kw">coord_quickmap</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">180</span>,<span class="dv">180</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">60</span>,<span class="dv">85</span>), <span class="dt">expand=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb19-159" data-line-number="159">  </a>
<a class="sourceLine" id="cb19-160" data-line-number="160">  <span class="co"># Turn plots into grob elements</span></a>
<a class="sourceLine" id="cb19-161" data-line-number="161">  p &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">list</span>(p1,p2,p3), ggplotGrob)</a>
<a class="sourceLine" id="cb19-162" data-line-number="162">  p &lt;-<span class="st"> </span><span class="kw">rbind</span>(p[[<span class="dv">1</span>]], p[[<span class="dv">2</span>]], p[[<span class="dv">3</span>]], <span class="dt">size=</span><span class="st">&quot;first&quot;</span>)</a>
<a class="sourceLine" id="cb19-163" data-line-number="163">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">which</span>(p<span class="op">$</span>layout<span class="op">$</span>name <span class="op">==</span><span class="st"> &quot;guide-box&quot;</span>)) {</a>
<a class="sourceLine" id="cb19-164" data-line-number="164">    p<span class="op">$</span>grobs[[i]] &lt;-<span class="st"> </span>p<span class="op">$</span>grobs[[i]]<span class="op">$</span>grobs[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb19-165" data-line-number="165">  }</a>
<a class="sourceLine" id="cb19-166" data-line-number="166">  <span class="kw">png</span>(<span class="dt">file=</span><span class="kw">paste0</span>(<span class="st">&quot;figures/low_clim_change_&quot;</span>, time, <span class="st">&quot;.png&quot;</span>), </a>
<a class="sourceLine" id="cb19-167" data-line-number="167">      <span class="dt">width=</span><span class="dv">10</span>, <span class="dt">height=</span><span class="dv">6</span>, <span class="dt">unit=</span><span class="st">&quot;in&quot;</span>, <span class="dt">res=</span><span class="dv">600</span>)</a>
<a class="sourceLine" id="cb19-168" data-line-number="168">  grid<span class="op">::</span><span class="kw">grid.draw</span>(p)</a>
<a class="sourceLine" id="cb19-169" data-line-number="169">  <span class="kw">dev.off</span>()</a>
<a class="sourceLine" id="cb19-170" data-line-number="170">})</a></code></pre></div>
<div id="create-line-graph-of-the-different-temperature-scenarios" class="section level3">
<h3>Create line graph of the different temperature scenarios</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co">#' Create maps and plots of climate data</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"></a>
<a class="sourceLine" id="cb20-3" data-line-number="3">filedir &lt;-<span class="st"> &quot;/home/mabi/Documents/Wissenschaft/Data&quot;</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4">filedir &lt;-<span class="st"> &quot;E:/Data&quot;</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="co"># Get climate files (csv with xy and BioClimVar)</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7">clim_data &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">paste0</span>(filedir, <span class="st">&quot;/ISIMIP2b/DerivedInputData/GCM/landonly&quot;</span>), <span class="dt">pattern=</span><span class="st">&quot;bioclim&quot;</span>,</a>
<a class="sourceLine" id="cb20-8" data-line-number="8">                        <span class="dt">recursive=</span><span class="ot">TRUE</span>, <span class="dt">full.names=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb20-9" data-line-number="9"></a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="co"># Retrieve information on Model, RCP and timeframe</span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11">models &lt;-<span class="st"> </span><span class="kw">lapply</span>(clim_data, <span class="cf">function</span>(x) <span class="kw">strsplit</span>(<span class="kw">basename</span>(x), <span class="dt">split=</span><span class="st">&quot;_&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb20-12" data-line-number="12">rcps &lt;-<span class="st"> </span><span class="kw">lapply</span>(clim_data, <span class="cf">function</span>(x) <span class="kw">strsplit</span>(<span class="kw">basename</span>(x), <span class="dt">split=</span><span class="st">&quot;_&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">3</span>])</a>
<a class="sourceLine" id="cb20-13" data-line-number="13">times &lt;-<span class="st"> </span><span class="kw">lapply</span>(clim_data, <span class="cf">function</span>(x) <span class="kw">strsplit</span>(<span class="kw">basename</span>(x), <span class="dt">split=</span><span class="st">&quot;[.;_]&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">4</span>])</a>
<a class="sourceLine" id="cb20-14" data-line-number="14"></a>
<a class="sourceLine" id="cb20-15" data-line-number="15"><span class="co"># Read in future climate files</span></a>
<a class="sourceLine" id="cb20-16" data-line-number="16">clim_data &lt;-<span class="st"> </span><span class="kw">lapply</span>(clim_data, <span class="cf">function</span>(x) readr<span class="op">::</span><span class="kw">read_csv</span>(x))</a>
<a class="sourceLine" id="cb20-17" data-line-number="17"></a>
<a class="sourceLine" id="cb20-18" data-line-number="18"><span class="co"># Add column for model type, rcp and timeframe to each list</span></a>
<a class="sourceLine" id="cb20-19" data-line-number="19">clim_data&lt;-<span class="st"> </span><span class="kw">Map</span>(cbind, clim_data, <span class="dt">model =</span> models, <span class="dt">rcp =</span> rcps, <span class="dt">time =</span> times)</a>
<a class="sourceLine" id="cb20-20" data-line-number="20"></a>
<a class="sourceLine" id="cb20-21" data-line-number="21"><span class="co"># Turn climate data into dataframe</span></a>
<a class="sourceLine" id="cb20-22" data-line-number="22">clim_data &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, clim_data)</a>
<a class="sourceLine" id="cb20-23" data-line-number="23"></a>
<a class="sourceLine" id="cb20-24" data-line-number="24"><span class="co"># Adjust EWEMBI data</span></a>
<a class="sourceLine" id="cb20-25" data-line-number="25"><span class="kw">str</span>(clim_data)</a>
<a class="sourceLine" id="cb20-26" data-line-number="26">clim_data<span class="op">$</span>time &lt;-<span class="st"> </span><span class="kw">as.character</span>(clim_data<span class="op">$</span>time)</a>
<a class="sourceLine" id="cb20-27" data-line-number="27">clim_data<span class="op">$</span>time[clim_data<span class="op">$</span>model <span class="op">==</span><span class="st"> &quot;EWEMBI&quot;</span>] &lt;-<span class="st"> </span><span class="dv">1995</span></a>
<a class="sourceLine" id="cb20-28" data-line-number="28">clim_data<span class="op">$</span>time &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(clim_data<span class="op">$</span>time)</a>
<a class="sourceLine" id="cb20-29" data-line-number="29">clim_data<span class="op">$</span>rcp &lt;-<span class="st"> </span><span class="kw">as.character</span>(clim_data<span class="op">$</span>rcp)</a>
<a class="sourceLine" id="cb20-30" data-line-number="30">clim_data<span class="op">$</span>rcp[clim_data<span class="op">$</span>model <span class="op">==</span><span class="st"> &quot;EWEMBI&quot;</span>] &lt;-<span class="st"> &quot;rcp26&quot;</span></a>
<a class="sourceLine" id="cb20-31" data-line-number="31">clim_ewembi &lt;-<span class="st"> </span>clim_data[clim_data<span class="op">$</span>model <span class="op">==</span><span class="st"> &quot;EWEMBI&quot;</span>,]</a>
<a class="sourceLine" id="cb20-32" data-line-number="32">clim_ewembi<span class="op">$</span>rcp &lt;-<span class="st"> &quot;rcp60&quot;</span></a>
<a class="sourceLine" id="cb20-33" data-line-number="33">clim_data &lt;-<span class="st"> </span><span class="kw">rbind</span>(clim_data, clim_ewembi); <span class="kw">rm</span>(clim_ewembi)</a>
<a class="sourceLine" id="cb20-34" data-line-number="34"></a>
<a class="sourceLine" id="cb20-35" data-line-number="35"><span class="co"># Only select bio4, bio5, bio12, bio15, bio18 bio19</span></a>
<a class="sourceLine" id="cb20-36" data-line-number="36"><span class="kw">library</span>(dplyr); <span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb20-37" data-line-number="37">clim_data &lt;-<span class="st"> </span>clim_data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(x, y, bio4, bio5, bio12, bio15, bio18, </a>
<a class="sourceLine" id="cb20-38" data-line-number="38">                                  bio19, model, rcp, time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-39" data-line-number="39"><span class="st">  </span><span class="kw">gather</span>(<span class="dt">key=</span>var, <span class="dt">value=</span>value, <span class="op">-</span><span class="kw">c</span>(x, y, model, rcp, time))</a>
<a class="sourceLine" id="cb20-40" data-line-number="40">clim_data<span class="op">$</span>var &lt;-<span class="st"> </span><span class="kw">factor</span>(clim_data<span class="op">$</span>var, </a>
<a class="sourceLine" id="cb20-41" data-line-number="41">                        <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;bio4&quot;</span>, <span class="st">&quot;bio5&quot;</span>, <span class="st">&quot;bio12&quot;</span>, <span class="st">&quot;bio15&quot;</span>, <span class="st">&quot;bio18&quot;</span>, <span class="st">&quot;bio19&quot;</span>),</a>
<a class="sourceLine" id="cb20-42" data-line-number="42">                        <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;Bio 4&quot;</span>, <span class="st">&quot;Bio 5&quot;</span>, <span class="st">&quot;Bio 12&quot;</span>, <span class="st">&quot;Bio 15&quot;</span>, <span class="st">&quot;Bio 18&quot;</span>, <span class="st">&quot;Bio 19&quot;</span>))</a>
<a class="sourceLine" id="cb20-43" data-line-number="43"></a>
<a class="sourceLine" id="cb20-44" data-line-number="44"><span class="kw">library</span>(rISIMIP)</a>
<a class="sourceLine" id="cb20-45" data-line-number="45"><span class="kw">data</span>(<span class="st">&quot;landseamask_generic&quot;</span>, <span class="dt">package=</span><span class="st">&quot;rISIMIP&quot;</span>)</a>
<a class="sourceLine" id="cb20-46" data-line-number="46">area &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">area</span>(landseamask_generic)</a>
<a class="sourceLine" id="cb20-47" data-line-number="47">area &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">rasterToPoints</span>(area))</a>
<a class="sourceLine" id="cb20-48" data-line-number="48"><span class="kw">colnames</span>(area) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;area&quot;</span>)</a>
<a class="sourceLine" id="cb20-49" data-line-number="49"></a>
<a class="sourceLine" id="cb20-50" data-line-number="50"><span class="co"># Add area of each cell to clim_data</span></a>
<a class="sourceLine" id="cb20-51" data-line-number="51">isimip_area &lt;-<span class="st"> </span>isimip_area</a>
<a class="sourceLine" id="cb20-52" data-line-number="52">clim_data &lt;-<span class="st"> </span><span class="kw">left_join</span>(clim_data, isimip_area, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>))</a>
<a class="sourceLine" id="cb20-53" data-line-number="53"></a>
<a class="sourceLine" id="cb20-54" data-line-number="54"><span class="co"># Create line graph</span></a>
<a class="sourceLine" id="cb20-55" data-line-number="55">clim_data &lt;-<span class="st"> </span><span class="kw">left_join</span>(clim_data, area, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>))</a>
<a class="sourceLine" id="cb20-56" data-line-number="56">clim_mean &lt;-<span class="st"> </span>clim_data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(time <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1995</span>, <span class="dv">2020</span>, <span class="dv">2050</span>, <span class="dv">2080</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-57" data-line-number="57"><span class="st">  </span><span class="kw">group_by</span>(model, rcp, time, var) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">mean=</span><span class="kw">weighted.mean</span>(value, <span class="dt">w=</span>area, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb20-58" data-line-number="58"><span class="kw">ggplot</span>(<span class="dt">data=</span>clim_mean, </a>
<a class="sourceLine" id="cb20-59" data-line-number="59">       <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>mean, </a>
<a class="sourceLine" id="cb20-60" data-line-number="60">           <span class="dt">colour=</span><span class="kw">factor</span>(model), <span class="dt">linetype=</span><span class="kw">factor</span>(rcp))) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-61" data-line-number="61"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb20-62" data-line-number="62"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-63" data-line-number="63"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>var, <span class="dt">scales=</span><span class="st">&quot;free_y&quot;</span>, <span class="dt">ncol=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-64" data-line-number="64"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">1995</span>,<span class="dv">2020</span>, <span class="dv">2050</span>,<span class="dv">2080</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-65" data-line-number="65"><span class="st">  </span><span class="kw">scale_colour_discrete</span>(<span class="dt">name=</span><span class="st">&quot;Model&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-66" data-line-number="66"><span class="st">  </span><span class="kw">scale_linetype_discrete</span>(<span class="dt">name=</span><span class="st">&quot;Scenario&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-67" data-line-number="67"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">strip.background=</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb20-68" data-line-number="68">                     <span class="dt">legend.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="ot">NA</span>),</a>
<a class="sourceLine" id="cb20-69" data-line-number="69">                     <span class="dt">panel.spacing.x=</span><span class="kw">unit</span>(<span class="fl">0.25</span>, <span class="st">&quot;lines&quot;</span>),</a>
<a class="sourceLine" id="cb20-70" data-line-number="70">                     <span class="dt">panel.spacing.y=</span><span class="kw">unit</span>(<span class="fl">0.25</span>, <span class="st">&quot;lines&quot;</span>))</a>
<a class="sourceLine" id="cb20-71" data-line-number="71"><span class="kw">ggsave</span>(<span class="st">&quot;figures/model_variables_1995_2080.pdf&quot;</span>, <span class="dt">width=</span><span class="dv">9</span>, <span class="dt">height=</span><span class="dv">6</span>, <span class="dt">dpi=</span><span class="dv">600</span>)</a>
<a class="sourceLine" id="cb20-72" data-line-number="72"></a>
<a class="sourceLine" id="cb20-73" data-line-number="73"><span class="co"># Load GitHub package</span></a>
<a class="sourceLine" id="cb20-74" data-line-number="74"><span class="kw">library</span>(ggmap2)</a>
<a class="sourceLine" id="cb20-75" data-line-number="75"></a>
<a class="sourceLine" id="cb20-76" data-line-number="76"><span class="co">#Plot Map of current climate data</span></a>
<a class="sourceLine" id="cb20-77" data-line-number="77">clim_data_wide &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb20-78" data-line-number="78"><span class="st">  </span><span class="kw">createMap</span>(<span class="dt">data=</span>clim_data_wide, <span class="dt">name=</span><span class="st">&quot;Bio4&quot;</span>)</a>
<a class="sourceLine" id="cb20-79" data-line-number="79"></a>
<a class="sourceLine" id="cb20-80" data-line-number="80"><span class="co"># Plot Map of future climate data</span></a>
<a class="sourceLine" id="cb20-81" data-line-number="81">climSub &lt;-<span class="st"> </span>clim[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">22</span>,<span class="dv">23</span>,<span class="dv">24</span>)]</a>
<a class="sourceLine" id="cb20-82" data-line-number="82">climSub &lt;-<span class="st"> </span>climSub[climSub<span class="op">$</span>rcp <span class="op">==</span><span class="st"> &quot;rcp26&quot;</span>,]</a>
<a class="sourceLine" id="cb20-83" data-line-number="83"><span class="kw">colnames</span>(climSub) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;value&quot;</span>, <span class="st">&quot;var&quot;</span>, <span class="st">&quot;rcp&quot;</span>, <span class="st">&quot;var2&quot;</span>)</a>
<a class="sourceLine" id="cb20-84" data-line-number="84"><span class="kw">createMap</span>(<span class="dt">data=</span>climSub, <span class="dt">split=</span><span class="ot">FALSE</span>, <span class="dt">facet_grid =</span> <span class="ot">TRUE</span>, <span class="dt">long=</span><span class="ot">TRUE</span>)</a></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
